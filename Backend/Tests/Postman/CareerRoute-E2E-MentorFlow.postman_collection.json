{
  "info": {
    "_postman_id": "careerroute-e2e-mentor-flow",
    "name": "CareerRoute - E2E Mentor Flow",
    "description": "End-to-end test flow for mentor operations:\n1. Login as Mentor\n2. Create Time Slots\n3. View Booked Sessions\n4. Start Session (Host URL)\n5. Complete Session\n6. View Earnings",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "1. Authentication",
      "item": [
        {
          "name": "1.1 Login as Mentor",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', () => pm.response.to.have.status(200));",
                  "",
                  "const data = pm.response.json().data;",
                  "if (data?.token) {",
                  "    pm.environment.set('mentorToken', data.token);",
                  "    pm.environment.set('mentorUserId', data.user?.id);",
                  "    console.log('✓ Logged in as Mentor:', data.user?.email);",
                  "    console.log('  User ID:', data.user?.id);",
                  "    console.log('  Role:', data.user?.role);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Content-Type", "value": "application/json"}],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"{{mentorEmail}}\",\n    \"password\": \"{{mentorPassword}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            }
          }
        }
      ]
    },
    {
      "name": "2. Time Slot Management",
      "item": [
        {
          "name": "2.1 Get My Time Slots",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', () => pm.response.to.have.status(200));",
                  "",
                  "const data = pm.response.json().data;",
                  "console.log('✓ Total time slots:', data?.length || 0);"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [{"key": "Authorization", "value": "Bearer {{mentorToken}}"}],
            "url": {
              "raw": "{{baseUrl}}/mentors/{{mentorUserId}}/time-slots",
              "host": ["{{baseUrl}}"],
              "path": ["mentors", "{{mentorUserId}}", "time-slots"]
            }
          }
        },
        {
          "name": "2.2 Create Time Slot",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// Set slot for tomorrow at 10:00 AM",
                  "const tomorrow = new Date();",
                  "tomorrow.setDate(tomorrow.getDate() + 1);",
                  "tomorrow.setHours(10, 0, 0, 0);",
                  "pm.environment.set('slotStartTime', tomorrow.toISOString());"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 201', () => pm.response.to.have.status(201));",
                  "",
                  "const data = pm.response.json().data;",
                  "if (data?.id) {",
                  "    pm.environment.set('createdSlotId', data.id);",
                  "    console.log('✓ Time slot created:', data.id);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "Authorization", "value": "Bearer {{mentorToken}}"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"startDateTime\": \"{{slotStartTime}}\",\n    \"durationMinutes\": 30\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/mentors/{{mentorUserId}}/time-slots",
              "host": ["{{baseUrl}}"],
              "path": ["mentors", "{{mentorUserId}}", "time-slots"]
            }
          }
        },
        {
          "name": "2.3 Delete Time Slot",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200 or 204', () => {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 204]);",
                  "    console.log('✓ Time slot deleted');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [{"key": "Authorization", "value": "Bearer {{mentorToken}}"}],
            "url": {
              "raw": "{{baseUrl}}/mentors/{{mentorUserId}}/time-slots/{{createdSlotId}}",
              "host": ["{{baseUrl}}"],
              "path": ["mentors", "{{mentorUserId}}", "time-slots", "{{createdSlotId}}"]
            }
          }
        }
      ]
    },
    {
      "name": "3. Session Management",
      "item": [
        {
          "name": "3.1 Get My Sessions",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200 or 404', () => {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const data = pm.response.json().data;",
                  "    let sessions = data?.sessions || data?.items || data;",
                  "    if (Array.isArray(sessions) && sessions.length > 0) {",
                  "        pm.environment.set('mentorSessionId', sessions[0].id);",
                  "        console.log('✓ Sessions found:', sessions.length);",
                  "    }",
                  "} else {",
                  "    console.log('No upcoming sessions found');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [{"key": "Authorization", "value": "Bearer {{mentorToken}}"}],
            "url": {
              "raw": "{{baseUrl}}/sessions/upcoming",
              "host": ["{{baseUrl}}"],
              "path": ["sessions", "upcoming"]
            }
          }
        },
        {
          "name": "3.2 Get Session Details",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (!pm.environment.get('mentorSessionId')) {",
                  "    console.log('⚠ No session ID - skipping (run Get My Sessions first)');",
                  "    return;",
                  "}",
                  "",
                  "pm.test('Status code is 200', () => pm.response.to.have.status(200));",
                  "",
                  "const data = pm.response.json().data;",
                  "console.log('✓ Session Status:', data?.status);",
                  "console.log('  Mentee:', data?.menteeName);",
                  "console.log('  Scheduled:', data?.scheduledStartTime);"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [{"key": "Authorization", "value": "Bearer {{mentorToken}}"}],
            "url": {
              "raw": "{{baseUrl}}/sessions/{{mentorSessionId}}",
              "host": ["{{baseUrl}}"],
              "path": ["sessions", "{{mentorSessionId}}"]
            }
          }
        },
        {
          "name": "3.3 Start Session (Get Host URL)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (!pm.environment.get('mentorSessionId')) {",
                  "    console.log('⚠ No session ID - skipping');",
                  "    return;",
                  "}",
                  "",
                  "pm.test('Status code is 200 or 409', () => {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 409]);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const data = pm.response.json().data;",
                  "    console.log('✓ Host URL:', data.startUrl || data.joinUrl);",
                  "} else {",
                  "    console.log('⏳ Session not within start window');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{"key": "Authorization", "value": "Bearer {{mentorToken}}"}],
            "url": {
              "raw": "{{baseUrl}}/sessions/{{mentorSessionId}}/join",
              "host": ["{{baseUrl}}"],
              "path": ["sessions", "{{mentorSessionId}}", "join"]
            }
          }
        }
      ]
    },
    {
      "name": "4. Profile & Earnings",
      "item": [
        {
          "name": "4.1 Get My Profile",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', () => pm.response.to.have.status(200));",
                  "",
                  "const data = pm.response.json().data;",
                  "console.log('✓ Profile:', data.firstName, data.lastName);",
                  "console.log('  Rate (30min):', data.rate30Min);",
                  "console.log('  Rate (60min):', data.rate60Min);"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [{"key": "Authorization", "value": "Bearer {{mentorToken}}"}],
            "url": {
              "raw": "{{baseUrl}}/mentors/me",
              "host": ["{{baseUrl}}"],
              "path": ["mentors", "me"]
            }
          }
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "test",
      "script": {
        "exec": [
          "pm.test('Response time < 5s', () => pm.expect(pm.response.responseTime).to.be.below(5000));"
        ]
      }
    }
  ]
}
